---
phase: 1.1-set-up-styling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - nuxt.config.ts
  - app/assets/scss/_variables.scss
  - app/assets/scss/_bulma-overrides.scss
  - app/assets/scss/_base.scss
  - app/assets/scss/_dark-mode.scss
  - app/assets/scss/main.scss
autonomous: true

must_haves:
  truths:
    - "Bulma CSS classes are available in Vue templates (e.g., .button, .navbar, .content)"
    - "SCSS variables ($type-s-red, $spacing-md, etc.) are accessible in Vue SFC <style lang='scss' scoped> blocks"
    - "Dark mode activates when data-theme='dark' is set on <html> element"
    - "Inter font is self-hosted (no external CDN requests in network tab)"
    - "Lucide icon components auto-import in Vue templates (e.g., <LucideSun />)"
  artifacts:
    - path: "package.json"
      provides: "All styling dependencies installed"
      contains: "bulma"
    - path: "nuxt.config.ts"
      provides: "Module registration, CSS entry, Vite SCSS config, colorMode config, fonts config"
      contains: "@nuxtjs/color-mode"
    - path: "app/assets/scss/_variables.scss"
      provides: "Design tokens: colors, spacing, radii, shadows, transitions"
      contains: "$type-s-red"
    - path: "app/assets/scss/_bulma-overrides.scss"
      provides: "Bulma variable overrides + modular component imports"
      contains: "@use 'bulma/sass/utilities'"
    - path: "app/assets/scss/_base.scss"
      provides: "Global base styles: links, images, tap targets, theme transitions"
      contains: "$type-s-red"
    - path: "app/assets/scss/_dark-mode.scss"
      provides: "Warm neutral dark mode CSS variable overrides"
      contains: "data-theme"
    - path: "app/assets/scss/main.scss"
      provides: "SCSS entry point importing all partials"
      contains: "@use './bulma-overrides'"
  key_links:
    - from: "nuxt.config.ts"
      to: "app/assets/scss/main.scss"
      via: "css: ['~/assets/scss/main.scss']"
      pattern: "css.*main\\.scss"
    - from: "nuxt.config.ts"
      to: "app/assets/scss/_variables.scss"
      via: "vite.css.preprocessorOptions.scss.additionalData"
      pattern: "additionalData.*variables"
    - from: "app/assets/scss/main.scss"
      to: "app/assets/scss/_bulma-overrides.scss"
      via: "@use './bulma-overrides'"
      pattern: "@use.*bulma-overrides"
---

<objective>
Install styling packages (Bulma, Sass, @nuxtjs/color-mode, @nuxt/fonts, nuxt-lucide-icons), configure nuxt.config.ts with all styling modules, and create the complete SCSS architecture with design tokens, Bulma overrides, base styles, and dark mode support.

Purpose: Establish the CSS foundation that all future UI phases build on. After this plan, Bulma classes work in templates, SCSS variables are available in component styles, dark mode CSS responds to data-theme, and Inter font is self-hosted.

Output: Updated package.json and nuxt.config.ts, plus 5 SCSS files in app/assets/scss/.
</objective>

<execution_context>
@/Users/rich/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/1.1-set-up-styling/1.1-RESEARCH.md
@.planning/phases/1.1-set-up-styling/1.1-CONTEXT.md
@nuxt.config.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install packages and configure nuxt.config.ts</name>
  <files>package.json, nuxt.config.ts</files>
  <action>
**Step 1: Install dependencies.**

```bash
yarn add bulma@1.0.4 sass @nuxtjs/color-mode @nuxt/fonts
yarn add -D nuxt-lucide-icons
```

`sass` and `bulma` are regular dependencies (used during `nuxi generate` build). `nuxt-lucide-icons` is devDependency.

**Step 2: Update `nuxt.config.ts`.**

Add new modules AFTER `@nuxt/eslint` (preserving the critical `@nuxtjs/seo` before `@nuxt/content` order):

```ts
modules: ['@nuxtjs/seo', '@nuxt/content', '@nuxt/eslint', '@nuxtjs/color-mode', '@nuxt/fonts', 'nuxt-lucide-icons'],
```

Add the following new config sections to nuxt.config.ts:

1. **CSS entry point:**
```ts
css: ['~/assets/scss/main.scss'],
```

2. **Vite SCSS preprocessor** (injects variables into every Vue SFC `<style lang="scss">` block):
```ts
vite: {
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: '@use "~/assets/scss/variables" as *;',
      },
    },
  },
},
```

CRITICAL: `additionalData` must ONLY inject variables/mixins (not CSS rules). Using `@use ... as *` exposes all variables without namespace prefix.

3. **Color mode config:**
```ts
colorMode: {
  preference: 'system',
  fallback: 'light',
  dataValue: 'theme',
  classSuffix: '',
  storage: 'localStorage',
  storageKey: 'de5-color-mode',
},
```

`dataValue: 'theme'` is the critical bridge -- it sets `data-theme="dark"` on `<html>`, which Bulma 1.x natively understands for dark mode CSS variable inversion.

4. **Font config:**
```ts
fonts: {
  defaults: {
    weights: [400, 500, 600, 700],
    styles: ['normal'],
    subsets: ['latin', 'latin-ext'],
  },
},
```

@nuxt/fonts auto-detects "Inter" from the font-family declaration in Bulma's utilities override and self-hosts it.

5. **Lucide config:**
```ts
lucide: {
  namePrefix: 'Lucide',
},
```

This enables auto-import of `<LucideSun />`, `<LucideMoon />`, etc.

**Step 3: Add SCSS to lint-staged in package.json.**

Update the second lint-staged pattern to include `.scss` files:

```json
"*.{json,md,yml,yaml,css,scss}": [
  "prettier --write"
]
```

**Important notes:**
- Do NOT use nuxt-purgecss. Research found it has a Nuxt 4 compatibility issue (GitHub #203, Jul 2025, minimally maintained). The user's goal of reduced bundle size is achieved via Bulma modular SCSS imports in _bulma-overrides.scss instead.
- Preserve all existing nuxt.config.ts settings (site, nitro, app, typescript, eslint, compatibilityDate).
- Add a brief comment before each new config section.
  </action>
  <verify>
1. `yarn install` completes without errors (run it after package changes).
2. `cat package.json | grep bulma` shows bulma in dependencies.
3. `cat package.json | grep nuxt-lucide-icons` shows it in devDependencies.
4. `cat nuxt.config.ts` shows all 6 modules in correct order, css array, vite config, colorMode config, fonts config, lucide config.
5. `yarn dev` starts without errors (start it briefly, confirm no SCSS/module errors, then stop).
  </verify>
  <done>
All 5 packages installed. nuxt.config.ts has modules in correct order (seo > content > eslint > color-mode > fonts > lucide-icons), css entry pointing to main.scss, vite additionalData injecting variables, colorMode with dataValue 'theme', fonts with Inter weights, lucide with namePrefix. lint-staged includes .scss files.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SCSS architecture (variables, Bulma overrides, base styles, dark mode, entry)</name>
  <files>
    app/assets/scss/_variables.scss
    app/assets/scss/_bulma-overrides.scss
    app/assets/scss/_base.scss
    app/assets/scss/_dark-mode.scss
    app/assets/scss/main.scss
  </files>
  <action>
Create the `app/assets/scss/` directory and all 5 SCSS files.

**File 1: `_variables.scss`** -- Design tokens for DE5.org

Define these SCSS variables (the project's design token system):

- **Brand colors:** `$type-s-red: #b81a35` (primary accent, used sparingly for links/buttons/hover)
- **Dark mode surfaces:** `$dark-bg-base: #171717`, `$dark-bg-surface: #262626`, `$dark-bg-elevated: #333333` (warm neutrals, no blue undertone)
- **Typography:** `$font-family-primary: 'Inter', 'SF Pro', 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif`
- **Spacing scale:** xs (0.25rem), sm (0.5rem), md (1rem), lg (1.5rem), xl (2rem), 2xl (3rem), 3xl (4rem)
- **Border radius:** `$radius-default: 0.375rem`, `$radius-lg: 0.75rem`
- **Shadows:** `$shadow-subtle: 0 1px 3px rgba(0, 0, 0, 0.08)`, `$shadow-card: 0 2px 8px rgba(0, 0, 0, 0.08)`
- **Transitions:** `$transition-fast: 150ms ease`, `$transition-normal: 250ms ease`, `$transition-slow: 350ms ease`

Add a section comment before each group.

**File 2: `_bulma-overrides.scss`** -- Bulma variable overrides + modular imports

Use the modern Sass `@use ... with (...)` syntax (NOT `@import`). Vite 7 enforces modern Sass API.

1. `@use './variables' as *` to load design tokens
2. `@use 'bulma/sass/utilities' with (...)` to override:
   - `$primary: $type-s-red`
   - `$family-primary: $font-family-primary`
   - `$radius: $radius-default`
   - `$radius-small: 0.25rem`
   - `$radius-large: $radius-lg`
   - `$gap: 32px`
   - `$block-spacing: 1.5rem`
3. Then `@forward` only the Bulma modules actually needed (modular imports for bundle size):
   - `bulma/sass/base` (reset + base styles)
   - `bulma/sass/themes` (CSS variable theming including dark mode)
   - `bulma/sass/grid/columns` (grid system)
   - Elements: button, content, icon, image, tag, title, box, table
   - Components: card, navbar, dropdown
   - Form: `bulma/sass/form` (full form module)
   - Layout: container, footer, hero, section

This modular approach replaces the need for nuxt-purgecss -- only imported Bulma modules are included in the bundle.

**File 3: `_base.scss`** -- Global base styles

1. `@use './variables' as *`
2. **Link styling:** `a:not(.button):not(.navbar-item):not(.tag)` -- color `$type-s-red`, no underline, underline on hover, transition on color/text-decoration
3. **Responsive images:** `img` -- `max-width: 100%`, `height: auto`
4. **Touch-friendly tap targets:** `button, a, [role='button']` -- `min-height: 44px`, `min-width: 44px` (but use more targeted selectors to avoid affecting inline links -- apply min-height only to button elements and `.button` class, not all `a` tags)
5. **Fixed navbar body padding:** `body` -- `padding-top: 3.25rem` (compensates for Bulma's `.is-fixed-top` navbar)

Do NOT add a global `*` transition rule for theme changes. Instead, let Bulma's CSS variables handle the transition naturally. A global transition on every element causes performance issues. If smooth dark mode transitions are desired, apply them selectively to `background-color` and `color` on `body` and key container elements only.

**File 4: `_dark-mode.scss`** -- Dark mode warm neutral overrides

1. `@use './variables' as *`
2. `[data-theme='dark']` selector:
   - Override `--bulma-scheme-main: #{$dark-bg-base}` (#171717)
   - Override `--bulma-scheme-main-bis: #{$dark-bg-surface}` (#262626)
   - Override `--bulma-scheme-main-ter: #{$dark-bg-elevated}` (#333333)
   - Override `--bulma-background: #{$dark-bg-surface}`
   - Override `--bulma-border: rgba(255, 255, 255, 0.12)` (subtle light border in dark mode)
   - Override `--bulma-shadow: 0 2px 8px rgba(0, 0, 0, 0.3)` (slightly stronger shadow in dark)
3. Add comment explaining: Bulma 1.x inverts its CSS variables natively with `[data-theme=dark]`, but defaults to slightly blue-tinted darks. These overrides switch to warm neutrals per design decision.

**File 5: `main.scss`** -- Entry point

```scss
// SCSS entry point for DE5.org
// Loads Bulma (with overrides) first, then custom styles
@use './bulma-overrides';
@use './base';
@use './dark-mode';
```

That's it -- minimal entry file. The `css: ['~/assets/scss/main.scss']` in nuxt.config.ts loads this globally.

**Important SCSS syntax notes:**
- Use `@use` and `@forward` everywhere. Never `@import` (deprecated, Vite 7 errors).
- Partials are prefixed with `_` (Sass convention) but referenced without the underscore in `@use` statements.
- Each partial uses `@use './variables' as *` to access design tokens. The `as *` avoids namespace prefixes.
  </action>
  <verify>
1. All 5 files exist in `app/assets/scss/`:
   ```bash
   ls app/assets/scss/
   ```
   Expected: `_base.scss`, `_bulma-overrides.scss`, `_dark-mode.scss`, `_variables.scss`, `main.scss`

2. `yarn dev` starts without SCSS compilation errors. Check terminal output for any Sass warnings or errors.

3. Verify `_variables.scss` contains `$type-s-red: #b81a35`.

4. Verify `_bulma-overrides.scss` uses `@use 'bulma/sass/utilities' with (...)` syntax (not `@import`).

5. Verify `main.scss` uses `@use` for all imports.
  </verify>
  <done>
Five SCSS files created with complete design token system, modular Bulma imports with variable overrides, base link/image/tap-target styles, warm neutral dark mode CSS variable overrides, and a minimal entry point. All files use modern `@use`/`@forward` syntax. `yarn dev` compiles without SCSS errors.
  </done>
</task>

</tasks>

<verification>
1. `yarn dev` starts without errors -- confirms packages installed, modules registered, SCSS compiles.
2. Open http://localhost:3000 in browser -- page loads (may look unstyled since layout shell is Plan 02).
3. Inspect `<html>` element -- should have `data-theme` attribute (set by @nuxtjs/color-mode).
4. Check Network tab -- no requests to fonts.googleapis.com (Inter self-hosted by @nuxt/fonts).
5. `yarn check` passes (lint + format + typecheck).
</verification>

<success_criteria>
- All 5 packages in package.json (bulma, sass, @nuxtjs/color-mode, @nuxt/fonts, nuxt-lucide-icons)
- nuxt.config.ts has 6 modules in correct order with all config sections
- 5 SCSS files exist with correct @use/@forward syntax
- `yarn dev` compiles without errors
- `yarn check` passes
</success_criteria>

<output>
After completion, create `.planning/phases/1.1-set-up-styling/1.1-01-SUMMARY.md`
</output>
