---
phase: 1.1-set-up-styling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - nuxt.config.ts
  - app/assets/scss/_variables.scss
  - app/assets/scss/_bulma-overrides.scss
  - app/assets/scss/_base.scss
  - app/assets/scss/_dark-mode.scss
  - app/assets/scss/main.scss
autonomous: true

must_haves:
  truths:
    - "Bulma CSS classes are available in Vue templates (e.g., .button, .navbar, .content, .columns)"
    - "SCSS variables ($type-s-red, $spacing-md, etc.) are accessible in Vue SFC <style lang='scss' scoped> blocks via vars.$ prefix"
    - "Dark mode activates when data-theme='dark' is set on <html> element (warm neutral backgrounds, not blue-tinted)"
    - "Inter font is self-hosted (no external CDN requests in network tab)"
    - "Lucide icon components auto-import in Vue templates (e.g., <LucideSun />)"
  artifacts:
    - path: "package.json"
      provides: "All styling dependencies installed"
      contains: "bulma"
    - path: "nuxt.config.ts"
      provides: "Module registration, CSS entry, Vite SCSS config, colorMode config, fonts config"
      contains: "@nuxtjs/color-mode"
    - path: "app/assets/scss/_variables.scss"
      provides: "Design tokens: colors, spacing, radii, shadows, transitions, typography"
      contains: "$type-s-red"
    - path: "app/assets/scss/_bulma-overrides.scss"
      provides: "Bulma variable overrides via @use ... with () and full Bulma import"
      contains: "@use 'bulma/sass' with"
    - path: "app/assets/scss/_base.scss"
      provides: "Global base styles: links, images, code blocks, tap targets, theme transitions"
      contains: "var(--bulma-primary)"
    - path: "app/assets/scss/_dark-mode.scss"
      provides: "Warm neutral dark mode CSS variable overrides"
      contains: "data-theme"
    - path: "app/assets/scss/main.scss"
      provides: "SCSS entry point importing all partials"
      contains: "@use './bulma-overrides'"
  key_links:
    - from: "nuxt.config.ts"
      to: "app/assets/scss/main.scss"
      via: "css: ['~/assets/scss/main.scss']"
      pattern: "css.*main\\.scss"
    - from: "nuxt.config.ts"
      to: "app/assets/scss/_variables.scss"
      via: "vite.css.preprocessorOptions.scss.additionalData"
      pattern: "additionalData.*variables"
    - from: "app/assets/scss/_bulma-overrides.scss"
      to: "app/assets/scss/_variables.scss"
      via: "@use './variables' as vars"
      pattern: "@use.*variables"
    - from: "app/assets/scss/main.scss"
      to: "app/assets/scss/_bulma-overrides.scss"
      via: "@use './bulma-overrides'"
      pattern: "@use.*bulma-overrides"
---

<objective>
Install styling packages (Bulma, Sass, @nuxtjs/color-mode, @nuxt/fonts, nuxt-lucide-icons), configure nuxt.config.ts with all styling modules, and create the complete SCSS architecture with design tokens, Bulma overrides, base styles, and dark mode support.

Purpose: Establish the CSS foundation that all future UI phases build on. After this plan, Bulma classes work in templates, SCSS variables are available in component styles, dark mode CSS responds to data-theme, and Inter font is self-hosted.

Output: Updated package.json and nuxt.config.ts, plus 5 SCSS files in app/assets/scss/.
</objective>

<execution_context>
@/Users/rich/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/1.1-set-up-styling/1.1-RESEARCH.md
@.planning/phases/1.1-set-up-styling/1.1-CONTEXT.md
@nuxt.config.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install packages and configure nuxt.config.ts</name>
  <files>package.json, nuxt.config.ts</files>
  <action>
**Step 1: Install dependencies.**

```bash
yarn add bulma@1.0.4 @nuxtjs/color-mode @nuxt/fonts nuxt-lucide-icons
yarn add -D sass
```

`bulma`, `@nuxtjs/color-mode`, `@nuxt/fonts`, and `nuxt-lucide-icons` are regular dependencies (used at runtime/build). `sass` is a devDependency (SCSS compiler, Vite uses it during build).

Do NOT install nuxt-purgecss. Research found it has a Nuxt 4 compatibility issue (GitHub #203, Jul 2025, minimally maintained). Bundle size is not a concern at this stage.

**Step 2: Update `nuxt.config.ts`.**

Add new modules AFTER `@nuxt/eslint`, preserving the critical `@nuxtjs/seo` before `@nuxt/content` order. Final module array:

```ts
modules: [
  '@nuxtjs/seo',         // MUST come before @nuxt/content (project constraint)
  '@nuxt/content',       // Content system
  '@nuxt/fonts',         // Font self-hosting (auto-detects Inter from CSS)
  '@nuxtjs/color-mode',  // Dark mode toggle with localStorage persistence
  'nuxt-lucide-icons',   // Icon auto-imports
  '@nuxt/eslint',        // Linting (existing)
],
```

Note: @nuxt/eslint moved to end of user-facing modules. This is fine -- it has no ordering constraint other than being present.

Add these new config sections to nuxt.config.ts (add a brief comment before each):

1. **CSS entry point:**
```ts
// Global SCSS entry point (loads Bulma with overrides + custom styles)
css: ['~/assets/scss/main.scss'],
```

2. **Color mode config** (critical: `dataValue: 'theme'` bridges @nuxtjs/color-mode with Bulma's `[data-theme=dark]` selector):
```ts
// Dark mode: defaults to system preference, user can override via toggle
colorMode: {
  preference: 'system',
  fallback: 'light',
  dataValue: 'theme',
  classSuffix: '',
  storage: 'localStorage',
  storageKey: 'de5-color-mode',
},
```

3. **Font config** (@nuxt/fonts auto-detects 'Inter' from the font-family in compiled CSS and self-hosts at build time via `/_fonts/`):
```ts
// Inter font: auto-detected from CSS, downloaded at build time, served locally
fonts: {
  defaults: {
    weights: [400, 500, 600, 700],
    styles: ['normal'],
    subsets: ['latin', 'latin-ext'],
  },
},
```

4. **Lucide icons config:**
```ts
// Lucide icons: auto-imported as <LucideSun />, <LucideMoon />, etc.
lucide: {
  namePrefix: 'Lucide',
},
```

5. **Vite SCSS preprocessor** (injects variables into every Vue SFC `<style lang="scss">` block):
```ts
// Make SCSS design tokens available in all Vue SFC style blocks
vite: {
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: '@use "~/assets/scss/variables" as vars;',
      },
    },
  },
},
```

CRITICAL: `additionalData` injects this line at the top of every SCSS compilation. Only variables/mixins should be injected this way (not CSS rules, which would be duplicated in every component). Variables are then accessed as `vars.$type-s-red`, `vars.$spacing-md`, etc. in SFC `<style lang="scss" scoped>` blocks.

**Step 3: Add `.scss` to lint-staged in package.json.**

Update the second lint-staged pattern to include `.scss` files:

```json
"*.{json,md,yml,yaml,css,scss}": [
  "prettier --write"
]
```

**Important:**
- Preserve ALL existing nuxt.config.ts settings (site, nitro, app, typescript, eslint, compatibilityDate).
- Add a brief comment before each new config section.
  </action>
  <verify>
1. `yarn install` completes without errors.
2. Verify package.json has `bulma`, `@nuxtjs/color-mode`, `@nuxt/fonts`, `nuxt-lucide-icons` in dependencies and `sass` in devDependencies.
3. Verify nuxt.config.ts has all 6 modules in order, css array, colorMode config (with `dataValue: 'theme'`), fonts config, lucide config, and vite preprocessorOptions.
4. Verify lint-staged pattern includes `.scss`.
5. `yarn dev` starts without module registration errors (it will fail on missing main.scss -- that is expected and resolved in Task 2).
  </verify>
  <done>
All 5 packages installed. nuxt.config.ts has modules in correct order (seo > content > fonts > color-mode > lucide-icons > eslint), css entry pointing to main.scss, colorMode with dataValue 'theme', fonts with Inter weights/subsets, lucide with namePrefix, and vite additionalData injecting variables as `vars` namespace. lint-staged includes .scss files.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SCSS architecture (variables, Bulma overrides, base styles, dark mode, entry)</name>
  <files>
    app/assets/scss/_variables.scss
    app/assets/scss/_bulma-overrides.scss
    app/assets/scss/_base.scss
    app/assets/scss/_dark-mode.scss
    app/assets/scss/main.scss
  </files>
  <action>
Create the `app/assets/scss/` directory and all 5 SCSS files.

**File 1: `_variables.scss`** -- Design tokens for DE5.org

Define these SCSS variables, each group preceded by a section comment:

```scss
// app/assets/scss/_variables.scss
// Design tokens for DE5.org

// -- Brand colors
$type-s-red: #b81a35;
// Alternate refs for Phase 8 review: #e82c2a (acura.com CSS), #E40521 (community)

// -- Dark mode surface colors (warm neutrals, no blue undertone)
$dark-bg-base: #171717;        // hsl(0, 0%, 9%)
$dark-bg-surface: #262626;     // hsl(0, 0%, 15%)
$dark-bg-elevated: #333333;    // hsl(0, 0%, 20%)

// -- Typography
$font-family-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI',
  Roboto, Oxygen, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans',
  'Helvetica Neue', sans-serif;

// -- Spacing scale
$spacing-xs: 0.25rem;    // 4px
$spacing-sm: 0.5rem;     // 8px
$spacing-md: 1rem;       // 16px
$spacing-lg: 1.5rem;     // 24px
$spacing-xl: 2rem;       // 32px
$spacing-2xl: 3rem;      // 48px
$spacing-3xl: 4rem;      // 64px

// -- Border radius
$radius-default: 0.375rem;   // 6px
$radius-lg: 0.75rem;         // 12px

// -- Shadows
$shadow-subtle: 0 1px 3px rgba(0, 0, 0, 0.08);
$shadow-card: 0 2px 8px rgba(0, 0, 0, 0.08);
$shadow-elevated: 0 8px 24px rgba(0, 0, 0, 0.12);

// -- Transitions
$transition-fast: 150ms ease;      // Hover states, button presses
$transition-base: 250ms ease;      // Color changes, opacity, theme transitions
$transition-slow: 350ms ease;      // Page transitions, larger layout shifts

// -- Layout
$content-max-width: 1024px;
```

**File 2: `_bulma-overrides.scss`** -- Override Bulma defaults and import Bulma

Use the modern Sass `@use ... with (...)` syntax (NOT deprecated `@import`). This is the ONLY place Bulma gets imported. All overrides MUST be in the single `@use` statement.

```scss
// app/assets/scss/_bulma-overrides.scss
// Override Bulma defaults, then import full Bulma framework
// Source: https://bulma.io/documentation/customize/with-sass/

@use './variables' as vars;

// Override Bulma's Sass variables BEFORE it compiles
// All overrides must be in this single @use statement
@use 'bulma/sass' with (
  $primary: vars.$type-s-red,
  $family-primary: vars.$font-family-primary,
  $radius: vars.$radius-default,
  $radius-small: 0.25rem,
  $radius-large: vars.$radius-lg,
  $scheme-h: 0,      // Warm neutral hue (default is 221 = blue)
  $scheme-s: 0%      // Zero saturation for pure neutrals
);
```

CRITICAL: `$scheme-h: 0` and `$scheme-s: 0%` eliminate Bulma's default blue undertone from ALL scheme-derived colors. This affects both light and dark modes -- light mode gets pure gray tones, dark mode gets warm neutral backgrounds.

**File 3: `_base.scss`** -- Global base styles on top of Bulma's minireset

```scss
// app/assets/scss/_base.scss
// Global base styles on top of Bulma's reset

@use './variables' as vars;

// -- Link styling: accent color, no underline, underline on hover
a:not(.button):not(.navbar-item):not(.tag) {
  color: var(--bulma-primary);
  text-decoration: none;
  transition: color vars.$transition-fast,
              text-decoration-color vars.$transition-fast;

  &:hover {
    text-decoration: underline;
  }
}

// -- Responsive images: constrain to container
img {
  max-width: 100%;
  height: auto;
}

// -- Code blocks: basic monospace styling (no syntax highlighting per user decision)
pre,
code {
  font-family: 'SF Mono', SFMono-Regular, Consolas, 'Liberation Mono', Menlo, monospace;
}

pre {
  padding: vars.$spacing-md;
  border-radius: vars.$radius-default;
  overflow-x: auto;
}

// -- Touch-friendly tap targets (44px minimum per WCAG)
button,
.button,
[role='button'] {
  min-height: 44px;
}

// -- Fixed navbar body offset (Bulma .is-fixed-top needs body padding)
body {
  padding-top: 3.25rem;
}

// -- Smooth color transitions for theme changes (selective, not global *)
body {
  transition: background-color vars.$transition-base,
              color vars.$transition-base;
}
```

Do NOT add a global `*` or `*, *::before, *::after` transition rule. That causes severe performance issues. The selective `body` transition is sufficient -- Bulma's CSS variables handle the rest via cascade.

**File 4: `_dark-mode.scss`** -- Dark mode warm neutral overrides

Bulma 1.x has built-in dark mode via `[data-theme=dark]` selector. Its default scheme uses `$scheme-h: 221` (blue tint). While we override at the Sass level in `_bulma-overrides.scss`, we also need CSS variable overrides for the dark theme to get exact warm neutral values.

```scss
// app/assets/scss/_dark-mode.scss
// Override Bulma dark theme for warm neutral backgrounds
// Default Bulma dark: $scheme-h: 221 (blue), $scheme-s: 14%
// Target: #171717 = hsl(0, 0%, 9%), #262626 = hsl(0, 0%, 15%)

@use './variables' as vars;

// Dark theme warm neutral overrides
// @nuxtjs/color-mode sets data-theme="dark" on <html> (via dataValue: 'theme')
// Bulma reads [data-theme=dark] and inverts its CSS variables
[data-theme='dark'] {
  // Zero hue/saturation for warm neutral (no blue undertone)
  --bulma-scheme-h: 0;
  --bulma-scheme-s: 0%;

  // Custom lightness values for warm neutral palette
  --bulma-scheme-main-l: 9%;          // #171717 (page background)
  --bulma-scheme-main-bis-l: 12%;     // slightly lighter surface
  --bulma-scheme-main-ter-l: 15%;     // #262626 equivalent (card/elevated surfaces)
  --bulma-background-l: 15%;          // #262626 for general backgrounds
}

// System preference fallback (for users who haven't toggled manually)
// :not([data-theme='light']) ensures manual light override is respected
@media (prefers-color-scheme: dark) {
  :root:not([data-theme='light']) {
    --bulma-scheme-h: 0;
    --bulma-scheme-s: 0%;
    --bulma-scheme-main-l: 9%;
    --bulma-scheme-main-bis-l: 12%;
    --bulma-scheme-main-ter-l: 15%;
    --bulma-background-l: 15%;
  }
}
```

**File 5: `main.scss`** -- Entry point

```scss
// app/assets/scss/main.scss
// SCSS entry point for DE5.org
// Loads Bulma (with overrides) first, then custom styles

// Bulma framework with variable overrides
@use './bulma-overrides';

// Global base styles (links, images, code blocks, tap targets)
@use './base';

// Dark mode warm neutral overrides
@use './dark-mode';
```

**Important SCSS syntax notes:**
- Use `@use` and `@forward` everywhere. NEVER use `@import` (deprecated in Dart Sass 1.80+, Vite 7 uses modern Sass API).
- Partials are prefixed with `_` (Sass convention) but referenced WITHOUT the underscore in `@use` statements.
- Each partial that needs design tokens uses `@use './variables' as vars` to access them.
- In Vue SFC `<style lang="scss" scoped>` blocks, variables are accessed as `vars.$type-s-red` because the `additionalData` in nuxt.config.ts injects `@use "~/assets/scss/variables" as vars;`.
  </action>
  <verify>
1. All 5 files exist:
   ```bash
   ls app/assets/scss/
   ```
   Expected: `_base.scss`, `_bulma-overrides.scss`, `_dark-mode.scss`, `_variables.scss`, `main.scss`

2. `yarn dev` starts without SCSS compilation errors. Check terminal output for any Sass warnings about `@import` deprecation (there should be NONE since we use `@use` exclusively).

3. Open http://localhost:3000 -- page loads with Bulma styling applied (existing page will look different because Bulma's reset + base styles now apply).

4. Inspect `<html>` element in DevTools -- should have `data-theme` attribute (set by @nuxtjs/color-mode).

5. Check Network tab -- no requests to fonts.googleapis.com or external CDNs (Inter should be self-hosted via `/_fonts/`). If Inter is NOT auto-detected, note this for Plan 02 to add explicit font config.

6. `yarn check` passes (lint + format + typecheck).
  </verify>
  <done>
Five SCSS files created: design tokens in _variables.scss, full Bulma import with $primary/$family-primary/$scheme-h/$scheme-s overrides in _bulma-overrides.scss, link/image/code/tap-target base styles in _base.scss, warm neutral dark mode CSS variable overrides in _dark-mode.scss, and minimal entry point in main.scss. All files use modern @use syntax. yarn dev compiles without SCSS errors and Bulma styles apply to the page.
  </done>
</task>

</tasks>

<verification>
1. `yarn dev` starts without errors -- confirms packages installed, modules registered, SCSS compiles.
2. Open http://localhost:3000 -- page loads with Bulma base styling (reset, typography).
3. Inspect `<html>` element -- has `data-theme` attribute (set by @nuxtjs/color-mode).
4. Check Network tab -- no requests to fonts.googleapis.com (Inter self-hosted by @nuxt/fonts).
5. `yarn check` passes (lint + format + typecheck).
</verification>

<success_criteria>
- All 5 packages in package.json (bulma, @nuxtjs/color-mode, @nuxt/fonts, nuxt-lucide-icons as deps; sass as devDep)
- nuxt.config.ts has 6 modules in correct order with all config sections
- 5 SCSS files exist with correct @use syntax (no @import anywhere)
- $scheme-h: 0 and $scheme-s: 0% set in both Sass override and CSS variable overrides
- yarn dev compiles without SCSS errors or deprecation warnings
- yarn check passes
</success_criteria>

<output>
After completion, create `.planning/phases/1.1-set-up-styling/1.1-01-SUMMARY.md`
</output>
