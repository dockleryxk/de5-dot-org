---
phase: 03-faq-display
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - content.config.ts
  - content/faqs/engine/oil-type-recommendation.md
  - content/faqs/engine/break-in-period.md
  - content/faqs/general/warranty-coverage.md
  - app/components/AppNavbar.vue
  - app/layouts/default.vue
  - app/pages/index.vue
autonomous: true

must_haves:
  truths:
    - "FAQ schema supports optional answers array with per-answer source attribution"
    - "Existing FAQ files validate against the updated schema (backward compatible)"
    - "Navbar is a standalone component with FAQs link and always-visible theme toggle"
    - "Homepage has a prominent link directing users to /faqs"
  artifacts:
    - path: "content.config.ts"
      provides: "Updated FAQ schema with answers array"
      contains: "z.array(z.object"
    - path: "app/components/AppNavbar.vue"
      provides: "Extracted navbar component"
      contains: "navbar-brand"
    - path: "app/layouts/default.vue"
      provides: "Layout using AppNavbar component"
      contains: "AppNavbar"
    - path: "app/pages/index.vue"
      provides: "Homepage with FAQ call-to-action"
      contains: "/faqs"
  key_links:
    - from: "app/layouts/default.vue"
      to: "app/components/AppNavbar.vue"
      via: "component usage"
      pattern: "AppNavbar"
    - from: "app/components/AppNavbar.vue"
      to: "/faqs"
      via: "NuxtLink"
      pattern: 'to="/faqs"'
    - from: "app/pages/index.vue"
      to: "/faqs"
      via: "NuxtLink CTA"
      pattern: 'to="/faqs"'
---

<objective>
Evolve the FAQ schema to support multi-answer source attribution, extract the navbar to its own component with always-visible theme toggle and FAQs link, and add a homepage call-to-action for the FAQ listing.

Purpose: Establish the schema and navigation infrastructure that Plan 02's listing and detail pages depend on.
Output: Updated content.config.ts, AppNavbar.vue component, updated default layout, updated homepage with CTA.
</objective>

<execution_context>
@/Users/rich/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-faq-display/03-CONTEXT.md
@.planning/phases/03-faq-display/03-RESEARCH.md
@.planning/phases/02-content-system/02-01-SUMMARY.md
@.planning/phases/1.1-set-up-styling/1.1-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Evolve FAQ schema for multi-answer support and update sample content</name>
  <files>
    content.config.ts
    content/faqs/engine/oil-type-recommendation.md
    content/faqs/engine/break-in-period.md
    content/faqs/general/warranty-coverage.md
  </files>
  <action>
    Update `content.config.ts` to add an optional `answers` array to the FAQ schema. The array holds per-answer source attribution objects:

    ```typescript
    // Multi-answer support: array of per-answer source attributions
    answers: z.array(z.object({
      sourceUrl: z.string(),
      sourceAuthor: z.string(),
      sourceDate: z.string(),
    })).optional(),
    ```

    Keep the existing top-level `sourceUrl`, `sourceAuthor`, `sourceDate` fields for backward compatibility. The `answers` field is `.optional()` so existing single-answer FAQs still validate.

    Then update `content/faqs/engine/oil-type-recommendation.md` to demonstrate the multi-answer pattern by adding an `answers` array in frontmatter with 2 source entries (the original source plus a second fictional community source). Keep the existing top-level source fields intact for backward compatibility.

    Leave `break-in-period.md` and `warranty-coverage.md` as single-answer FAQs (no `answers` array) to verify backward compatibility.

    After changes, run `npx nuxi prepare` to confirm the schema validates. Then run `yarn dev` briefly and verify no build errors.
  </action>
  <verify>
    Run `npx nuxi prepare` -- should complete without errors.
    Run `yarn dev` and confirm no schema validation errors in the console.
    Verify all 3 FAQ files are accessible via the dev server (no 500 errors).
  </verify>
  <done>
    FAQ schema includes optional `answers` array with per-answer sourceUrl/sourceAuthor/sourceDate. One sample FAQ demonstrates multi-answer format. Two sample FAQs validate without the answers array (backward compatible).
  </done>
</task>

<task type="auto">
  <name>Task 2: Extract navbar to AppNavbar component with always-visible theme toggle and FAQs link</name>
  <files>
    app/components/AppNavbar.vue
    app/layouts/default.vue
  </files>
  <action>
    Create `app/components/AppNavbar.vue` by extracting the navbar from `app/layouts/default.vue`.

    The extracted AppNavbar component should:
    1. Move the ThemeToggle from `navbar-menu` (inside hamburger) into `navbar-brand` (always visible at all viewport sizes). Place it between the site name link and the hamburger button. Per research: elements in `navbar-brand` are always visible, even when the hamburger menu is collapsed on mobile.
    2. Add a "FAQs" NuxtLink in `navbar-end` inside `navbar-menu`. The link goes to `/faqs`. This means the FAQs link will be in the collapsible menu on mobile (appropriate for a secondary nav item).
    3. Keep the `menuOpen` ref and route watcher for closing the menu on navigation inside the AppNavbar component (move it from default.vue).
    4. Use `<template lang="pug">` and `<script setup lang="ts">`.
    5. Follow the exact Pug structure from the research Pattern 4 (navbar extraction).
    6. Ensure the navbar-burger still has exactly 4 `span` elements (Bulma 1.x requirement).

    Update `app/layouts/default.vue` to:
    1. Replace the inline navbar with `AppNavbar` component usage.
    2. Remove the `menuOpen` ref and route watcher (now in AppNavbar).
    3. Keep the `main > slot` and `footer` as-is.

    The layout should be simplified to roughly:
    ```pug
    div
      //- Site navigation bar
      AppNavbar
      //- Page content
      main
        slot
      //- Site footer
      footer.footer
        .content.has-text-centered
          p &copy; {{ new Date().getFullYear() }} DE5.org â€” ...
    ```
  </action>
  <verify>
    Run `yarn dev` and verify:
    - Navbar renders with site name, theme toggle visible outside hamburger, and FAQs link in menu.
    - Theme toggle works (sun/moon icon changes, dark mode applies).
    - On narrow viewport (< 1024px): theme toggle visible, FAQs link hidden behind hamburger, hamburger toggles menu.
    - On wide viewport (>= 1024px): theme toggle visible, FAQs link visible in navbar-end.
    - Menu closes on navigation (route watcher).
    Run `yarn lint` -- no errors.
  </verify>
  <done>
    Navbar extracted to AppNavbar.vue. ThemeToggle in navbar-brand (visible at all viewport sizes). FAQs link in navbar-end. Default layout simplified to use AppNavbar component. Mobile hamburger and route-close behavior preserved.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add FAQ call-to-action on homepage</name>
  <files>
    app/pages/index.vue
  </files>
  <action>
    Update `app/pages/index.vue` to add a prominent call-to-action directing users to /faqs. Replace the placeholder "Coming soon" text with an actual CTA.

    Approach:
    1. Keep the existing page heading (h1 "DE5.org", h2 subtitle).
    2. Update the content block: replace the "Coming soon" paragraph with a clear call-to-action. Use a Bulma button as a prominent link:
       ```pug
       //- Call-to-action linking to FAQ listing
       NuxtLink.button.is-primary.is-medium(to="/faqs")
         | Browse FAQs
       ```
    3. Keep the three sample card boxes (FAQs, Guides, Community) but update the FAQs card to link to /faqs:
       ```pug
       .column.is-one-third
         NuxtLink.box(to="/faqs" style="display: block;")
           h3.title.is-5 FAQs
           p Common questions answered with sources.
       ```
    4. Keep the existing `useHead({ title: 'Home' })`.

    The overall intent: the homepage now has a clear primary action (Browse FAQs button) plus a clickable FAQs card in the feature grid.
  </action>
  <verify>
    Run `yarn dev` and navigate to `/`. Verify:
    - "Browse FAQs" button is visible and links to /faqs.
    - FAQs card in the columns section links to /faqs.
    - Other cards remain unchanged.
    Run `yarn lint` -- no errors.
  </verify>
  <done>
    Homepage has prominent "Browse FAQs" button CTA and clickable FAQs card, both linking to /faqs.
  </done>
</task>

</tasks>

<verification>
After all 3 tasks:
1. `yarn dev` starts without errors.
2. Schema validates all 3 existing FAQ files (1 with answers array, 2 without).
3. Navbar shows DE5.org brand, always-visible theme toggle, FAQs link, working hamburger.
4. Homepage links to /faqs via button CTA and FAQs card.
5. `yarn lint` passes.
6. `yarn generate` succeeds (SSG build).
</verification>

<success_criteria>
- FAQ schema supports optional per-answer source attribution array
- Navbar is a standalone component with theme toggle always visible
- FAQs navigation link present in navbar
- Homepage provides clear path to /faqs
- All existing content validates against updated schema
</success_criteria>

<output>
After completion, create `.planning/phases/03-faq-display/03-01-SUMMARY.md`
</output>
